<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package Name="TaskbarMonitor" Manufacturer="m4549" Version="1.0.0.0" UpgradeCode="a2b3c4d5-e6f7-8901-2345-67790abcdef0">
    <MajorUpgrade DowngradeErrorMessage="A later version of [ProductName] is already installed. Setup will now exit." />

    <MediaTemplate EmbedCab="yes" />

    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLFOLDER" Name="TaskbarMonitor" />
    </StandardDirectory>

    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="TaskbarMonitor"/>
    </StandardDirectory>

    <StandardDirectory Id="StartupFolder" />

    <Feature Id="Main">
      <ComponentGroupRef Id="MainComponents" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="StartupShortcut" />
    </Feature>
    
    <ui:WixUI Id="WixUI_InstallDir" InstallDirectory="INSTALLFOLDER" />
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
  </Package>

  <Fragment>
    <!-- Shortcut in Start Menu -->
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="b3c4d5e6-f789-0123-4567-890abcdef012">
        <Shortcut Id="ApplicationStartMenuShortcut" 
                  Name="TaskbarMonitor" 
                  Description="Taskbar Monitor Widget"
                  Target="[INSTALLFOLDER]TaskbarMonitor.exe"
                  WorkingDirectory="INSTALLFOLDER"/>
        <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\m4549\TaskbarMonitor" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <!-- Shortcut in Startup Folder -->
    <DirectoryRef Id="StartupFolder">
      <Component Id="StartupShortcut" Guid="c4d5e6f7-8901-2345-6789-0123456789ab">
        <Shortcut Id="ApplicationStartupShortcut" 
                  Name="TaskbarMonitor" 
                  Description="Taskbar Monitor Widget"
                  Target="[INSTALLFOLDER]TaskbarMonitor.exe"
                  WorkingDirectory="INSTALLFOLDER"/>
        <RegistryValue Root="HKCU" Key="Software\m4549\TaskbarMonitor" Name="autostart" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <!-- Components -->
    <ComponentGroup Id="MainComponents" Directory="INSTALLFOLDER">
      <!-- Main Executables (Single File) -->
      <Component><File Source="..\TaskbarMonitor\bin\Release\net8.0-windows\win-x64\publish\TaskbarMonitor.exe" /></Component>
      
      <!-- Config -->
      <Component><File Source="..\TaskbarMonitor\bin\Release\net8.0-windows\win-x64\publish\appsettings.json" /></Component>
    </ComponentGroup>
  </Fragment>
</Wix>
